<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://qingxuan.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://qingxuan.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-设计模式/设计模式｜工厂模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BD%9C%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2024-03-20T12:31:27.108Z" itemprop="datePublished">2024-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BD%9C%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/">设计模式｜工厂模式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="/img.png" alt="img.png"></p>
<p>工厂模式是一种常见的设计模式，在Java开发中被广泛应用。它属于创建型设计模式，旨在提供一种封装对象创建过程的方法，使得客户端代码可以与具体创建对象的过程解耦。</p>
<h1 id="1-工厂模式的三种实现"><a href="#1-工厂模式的三种实现" class="headerlink" title="1. 工厂模式的三种实现"></a>1. 工厂模式的三种实现</h1><p>在Java中，工厂模式通常有三种实现方式：简单工厂模式、工厂方法模式和抽象工厂模式。</p>
<ul>
<li><strong>简单工厂模式（Simple Factory Pattern）</strong>：<ul>
<li>简单工厂模式通过一个工厂类来创建对象，客户端通过传递不同的参数给工厂类，工厂类根据参数的不同来创建不同的对象实例。</li>
<li>优点是客户端代码简单，隐藏了具体对象的创建细节。</li>
<li>缺点是当需要添加新的产品时，需要修改工厂类的代码，违反了开闭原则。</li>
</ul>
</li>
<li><strong>工厂方法模式（Factory Method Pattern）</strong>：<ul>
<li>工厂方法模式将对象的创建延迟到子类中去实现，即定义一个创建对象的接口，但让子类决定实例化哪个类。</li>
<li>客户端通过调用工厂方法来创建对象，具体的实例化过程由子类负责。</li>
<li>这样可以解决简单工厂模式中的缺点，使得系统更具灵活性和可扩展性。</li>
</ul>
</li>
<li><strong>抽象工厂模式（Abstract Factory Pattern）</strong>：<ul>
<li>抽象工厂模式提供一个接口用于创建一系列相关或依赖对象的家族，而不需要指定具体的类。</li>
<li>与工厂方法模式相比，抽象工厂模式是针对多个产品等级结构的，可以创建不同产品族的全部产品。</li>
<li>这种模式适用于需要在运行时切换不同产品族的场景，但增加新的产品族往往不太容易。</li>
</ul>
</li>
</ul>
<h1 id="2-简单工厂模式和工厂方法模式示例"><a href="#2-简单工厂模式和工厂方法模式示例" class="headerlink" title="2. 简单工厂模式和工厂方法模式示例"></a>2. 简单工厂模式和工厂方法模式示例</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 简单工厂模式示例</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Product <span class="title function_">createProduct</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (type.equals(<span class="string">&quot;A&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProductA</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type.equals(<span class="string">&quot;B&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProductB</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductA</span> <span class="keyword">implements</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Product A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductB</span> <span class="keyword">implements</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Product B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂方法模式示例</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    Product <span class="title function_">createProduct</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFactoryA</span> <span class="keyword">implements</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">createProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProductA</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFactoryB</span> <span class="keyword">implements</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">createProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProductB</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 简单工厂模式示例</span></span><br><span class="line">        <span class="type">Product</span> <span class="variable">productA</span> <span class="operator">=</span> SimpleFactory.createProduct(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        productA.doSomething();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 工厂方法模式示例</span></span><br><span class="line">        <span class="type">Factory</span> <span class="variable">factoryA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteFactoryA</span>();</span><br><span class="line">        <span class="type">Product</span> <span class="variable">productB</span> <span class="operator">=</span> factoryA.createProduct();</span><br><span class="line">        productB.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上示例中，简单工厂模式中的 <code>SimpleFactory</code> 负责创建具体产品对象，而工厂方法模式中的 <code>Factory</code> 接口定义了创建产品的方法，具体的产品创建由不同的具体工厂类实现。</p>
<h1 id="3-抽象工厂模式示例"><a href="#3-抽象工厂模式示例" class="headerlink" title="3. 抽象工厂模式示例"></a>3. 抽象工厂模式示例</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象工厂模式示例</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line">    AbstractProductA <span class="title function_">createProductA</span><span class="params">()</span>;</span><br><span class="line">    AbstractProductB <span class="title function_">createProductB</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AbstractProductA</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AbstractProductB</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFactory1</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> AbstractProductA <span class="title function_">createProductA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProductA1</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AbstractProductB <span class="title function_">createProductB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProductB1</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteFactory2</span> <span class="keyword">implements</span> <span class="title class_">AbstractFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> AbstractProductA <span class="title function_">createProductA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProductA2</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AbstractProductB <span class="title function_">createProductB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProductB2</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductA1</span> <span class="keyword">implements</span> <span class="title class_">AbstractProductA</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Product A1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductA2</span> <span class="keyword">implements</span> <span class="title class_">AbstractProductA</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Product A2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductB1</span> <span class="keyword">implements</span> <span class="title class_">AbstractProductB</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Product B1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteProductB2</span> <span class="keyword">implements</span> <span class="title class_">AbstractProductB</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Product B2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AbstractFactory</span> <span class="variable">factory1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteFactory1</span>();</span><br><span class="line">        <span class="type">AbstractProductA</span> <span class="variable">productA1</span> <span class="operator">=</span> factory1.createProductA();</span><br><span class="line">        <span class="type">AbstractProductB</span> <span class="variable">productB1</span> <span class="operator">=</span> factory1.createProductB();</span><br><span class="line"></span><br><span class="line">        productA1.doSomething();</span><br><span class="line">        productB1.doSomething();</span><br><span class="line"></span><br><span class="line">        <span class="type">AbstractFactory</span> <span class="variable">factory2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteFactory2</span>();</span><br><span class="line">        <span class="type">AbstractProductA</span> <span class="variable">productA2</span> <span class="operator">=</span> factory2.createProductA();</span><br><span class="line">        <span class="type">AbstractProductB</span> <span class="variable">productB2</span> <span class="operator">=</span> factory2.createProductB();</span><br><span class="line"></span><br><span class="line">        productA2.doSomething();</span><br><span class="line">        productB2.doSomething();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在这个示例中，<code>AbstractFactory</code> 是抽象工厂接口，定义了创建一组相关产品的方法。</li>
<li><code>ConcreteFactory1</code> 和 <code>ConcreteFactory2</code> 是具体工厂类，分别实现了抽象工厂接口，用于创建一组特定的产品。</li>
<li><code>AbstractProductA</code> 和 <code>AbstractProductB</code> 是抽象产品接口，分别定义了产品 A 和产品 B 的方法。</li>
<li><code>ConcreteProductA1</code>、<code>ConcreteProductA2</code>、<code>ConcreteProductB1</code> 和 <code>ConcreteProductB2</code> 是具体产品类，分别实现了抽象产品接口，用于提供具体的产品功能。</li>
<li>在 <code>Main</code> 类中，通过创建不同的具体工厂对象来获取不同的产品族，然后调用产品的方法来实现具体的功能。</li>
</ul>
<h1 id="4-工厂模式与多态的关系"><a href="#4-工厂模式与多态的关系" class="headerlink" title="4. 工厂模式与多态的关系"></a>4. 工厂模式与多态的关系</h1><p>工厂模式与多态之间有着密切的关系，因为工厂模式往往利用了多态的特性来实现对象的创建和使用。<br>多态是面向对象编程中的一个重要概念，它允许不同的对象对同一个消息作出不同的响应。在Java中，多态性可以通过继承和接口实现，其中子类或实现了接口的类可以覆写父类或接口中的方法，实现方法的多态性。<br>工厂模式利用多态性来实现创建对象的过程，具体来说：</p>
<ul>
<li>工厂方法模式<ul>
<li>工厂方法模式中，工厂类定义了一个创建产品的抽象方法，具体的产品创建延迟到具体的子类工厂中去实现。</li>
<li>这里的多态性体现在客户端通过调用工厂方法来创建对象，而不需要关心具体的实现类是哪个，具体的实例化过程由子类负责，从而达到了解耦的目的。</li>
</ul>
</li>
<li>抽象工厂模式<ul>
<li>抽象工厂模式中，抽象工厂定义了创建一系列相关或依赖对象的接口，具体的产品族创建由具体的工厂类去实现。</li>
<li>这里的多态性体现在客户端针对抽象工厂编程，而不需要关心具体的工厂类是哪个，具体的工厂类根据客户端的选择来创建不同的产品族。</li>
</ul>
</li>
</ul>
<p>总的来说，工厂模式通过利用多态性，将对象的创建过程和客户端代码解耦，提高了代码的灵活性和可维护性。在使用工厂模式时，客户端通常面向工厂接口或抽象工厂类编程，从而利用多态性来实现不同产品的创建和使用。</p>
<h1 id="5-工程模式与策略模式的关系"><a href="#5-工程模式与策略模式的关系" class="headerlink" title="5. 工程模式与策略模式的关系"></a>5. 工程模式与策略模式的关系</h1><p>工厂模式（Factory Pattern）和策略模式（Strategy Pattern）是两种不同类型的设计模式，它们解决了不同的问题，但有时候也可以结合使用，互相配合，以达到更好的设计效果。</p>
<ul>
<li>工厂模式：<ul>
<li>工厂模式旨在提供一种封装对象创建过程的方法，使得客户端代码可以与具体创建对象的过程解耦。</li>
<li>工厂模式根据需要实例化的对象类型，通过工厂类来创建对象，客户端只需要与工厂接口或抽象工厂类交互，而不需要直接与具体产品类交互。</li>
<li>工厂模式通常用于创建对象的场景，比如创建数据库连接、日志记录器等。</li>
</ul>
</li>
<li>策略模式：<ul>
<li>策略模式旨在定义一系列算法，并将每个算法封装起来，使它们可以互相替换，从而使算法的变化独立于使用算法的客户端。</li>
<li>策略模式通过定义一个接口或抽象类来封装算法族，然后通过具体的策略类来实现具体的算法，客户端可以根据需要选择不同的策略来使用。</li>
<li>策略模式通常用于算法的变化频繁、需要在运行时动态选择算法或者需要将算法与客户端解耦的场景。</li>
</ul>
</li>
</ul>
<p>虽然工厂模式和策略模式解决了不同的问题，但在某些情况下它们可以结合使用：</p>
<ul>
<li>策略模式的工厂：在策略模式中，具体的策略类通常由客户端根据需要进行选择，而这个选择过程也可以由工厂模式来完成。工厂类可以根据某些条件或者策略来实例化具体的策略对象，从而使客户端更加灵活地选择策略。</li>
<li>工厂模式中的策略：在工厂模式中，工厂类可以被视为一种策略的实现，根据客户端的需求选择合适的工厂来创建对象，这样客户端就可以在不同的情况下使用不同的创建策略。</li>
</ul>
<p>综上所述，工厂模式和策略模式虽然解决了不同的问题，但在一些情况下可以结合使用，以满足更复杂的设计需求。</p>
<h1 id="6-面试中可能遇到的问题"><a href="#6-面试中可能遇到的问题" class="headerlink" title="6. 面试中可能遇到的问题"></a>6. 面试中可能遇到的问题</h1><p>与工厂模式相关的问题可能涉及到工厂模式的概念、使用场景、实现方式以及与其他设计模式的比较等方面。以下是一些可能会被问及的问题</p>
<h2 id="6-1-工厂模式的概念是什么？"><a href="#6-1-工厂模式的概念是什么？" class="headerlink" title="6.1  工厂模式的概念是什么？"></a>6.1  <strong>工厂模式的概念是什么？</strong></h2><ul>
<li>工厂模式是一种创建型设计模式，它提供了一种封装对象创建过程的方法，使得客户端代码可以与具体创建对象的过程解耦。</li>
<li>其核心思想是通过工厂类来创建对象，而不是直接在客户端代码中通过 new 操作符实例化对象。</li>
</ul>
<h2 id="6-2-工厂模式解决了什么问题？"><a href="#6-2-工厂模式解决了什么问题？" class="headerlink" title="6.2  工厂模式解决了什么问题？"></a>6.2  <strong>工厂模式解决了什么问题？</strong></h2><ul>
<li>工厂模式解决了客户端代码与具体对象创建过程之间的耦合问题。它使得客户端不需要知道对象的具体创建细节，只需要通过工厂类来获取所需的对象实例。</li>
</ul>
<h2 id="6-3-工厂模式的优点是什么？"><a href="#6-3-工厂模式的优点是什么？" class="headerlink" title="6.3 工厂模式的优点是什么？"></a>6.3 <strong>工厂模式的优点是什么？</strong></h2><ul>
<li>解耦客户端和具体类的实现，降低了代码的依赖性；</li>
<li>提供了一种统一的接口来创建对象，使得客户端代码更加灵活和可维护；</li>
<li>可以隐藏对象创建的细节，对客户端代码进行了抽象。</li>
</ul>
<h2 id="6-4-工厂模式有哪些不同的实现方式？"><a href="#6-4-工厂模式有哪些不同的实现方式？" class="headerlink" title="6.4 工厂模式有哪些不同的实现方式？"></a>6.4 <strong>工厂模式有哪些不同的实现方式？</strong></h2><p>工厂模式有三种主要的实现方式：</p>
<ul>
<li>简单工厂模式、工厂方法模式和抽象工厂模式。<ul>
<li>简单工厂模式通过一个工厂类来创建对象；</li>
<li>工厂方法模式将对象的创建延迟到具体的子类中去实现；</li>
<li>而抽象工厂模式提供一个接口用于创建一系列相关或依赖对象的家族，而不需要指定具体的类。</li>
</ul>
</li>
</ul>
<h2 id="6-5-举例说明简单工厂模式、工厂方法模式和抽象工厂模式的实现吗？"><a href="#6-5-举例说明简单工厂模式、工厂方法模式和抽象工厂模式的实现吗？" class="headerlink" title="6.5 举例说明简单工厂模式、工厂方法模式和抽象工厂模式的实现吗？"></a>6.5 <strong>举例说明简单工厂模式、工厂方法模式和抽象工厂模式的实现吗？</strong></h2><ul>
<li>简单工厂模式示例：一个汽车制造工厂（CarFactory）生产不同型号的汽车（例如：奥迪、宝马、奔驰）。</li>
<li>工厂方法模式示例：一个汽车制造工厂（CarFactory）接口定义了生产汽车的抽象方法，具体的汽车制造工厂（例如：奥迪工厂、宝马工厂、奔驰工厂）继承该接口，并实现了具体的汽车生产方法。</li>
<li>抽象工厂模式示例：一个汽车配件制造工厂（CarPartsFactory）接口定义了生产汽车零件的抽象方法，具体的汽车配件制造工厂（例如：德国工厂、日本工厂）继承该接口，并实现了具体的汽车零件生产方法。</li>
</ul>
<h2 id="6-6-工厂模式在什么场景下使用比较合适？"><a href="#6-6-工厂模式在什么场景下使用比较合适？" class="headerlink" title="6.6 工厂模式在什么场景下使用比较合适？"></a>6.6 <strong>工厂模式在什么场景下使用比较合适？</strong></h2><ul>
<li>工厂模式适用于需要根据不同条件创建不同类型对象的场景，以及对象的创建过程比较复杂、需要隐藏创建细节的场景。</li>
<li>它特别适用于需要创建一系列相关对象或对象族的情况。</li>
</ul>
<h2 id="6-7-使用工厂模式有什么优点？它解决了哪些问题？"><a href="#6-7-使用工厂模式有什么优点？它解决了哪些问题？" class="headerlink" title="6.7 使用工厂模式有什么优点？它解决了哪些问题？"></a>6.7 <strong>使用工厂模式有什么优点？它解决了哪些问题？</strong></h2><ul>
<li>工厂模式的优点包括：解耦、灵活性和可维护性。</li>
<li>它将对象的创建过程集中在一个地方，使得客户端代码更加简洁、灵活，并且易于扩展和维护。</li>
</ul>
<h2 id="6-8-工厂模式有什么缺点？在什么情况下不适合使用？"><a href="#6-8-工厂模式有什么缺点？在什么情况下不适合使用？" class="headerlink" title="6.8 工厂模式有什么缺点？在什么情况下不适合使用？"></a>6.8 <strong>工厂模式有什么缺点？在什么情况下不适合使用？</strong></h2><ul>
<li>工厂模式的缺点是如果产品种类过多，会导致工厂类代码过于复杂；</li>
<li>并且在简单工厂模式在添加新产品时，需要修改工厂类，违反了开闭原则。不适合在产品种类频繁变化的场景中使用。</li>
</ul>
<h2 id="6-9-能否举例说明工厂模式在实际项目中的应用场景？"><a href="#6-9-能否举例说明工厂模式在实际项目中的应用场景？" class="headerlink" title="6.9 能否举例说明工厂模式在实际项目中的应用场景？"></a>6.9 <strong>能否举例说明工厂模式在实际项目中的应用场景？</strong></h2><ul>
<li>工厂模式在实际项目中有许多应用场景，例如在数据库访问框架中，通过工厂模式来创建不同类型的数据库连接对象；在日志记录框架中，通过工厂模式来创建不同类型的日志记录器对象等。</li>
</ul>
<h2 id="6-10-工厂模式和抽象工厂模式有什么区别？"><a href="#6-10-工厂模式和抽象工厂模式有什么区别？" class="headerlink" title="6.10 工厂模式和抽象工厂模式有什么区别？"></a>6.10 <strong>工厂模式和抽象工厂模式有什么区别？</strong></h2><ul>
<li>工厂模式关注于创建单个对象，它提供了一个统一的接口来创建对象；</li>
<li>而抽象工厂模式关注于创建一系列相关或依赖对象的家族，它提供了一个接口来创建不同类型对象的多个系列；</li>
<li>它们适用于不同的场景，工厂模式适用于创建单个对象，而抽象工厂模式适用于创建多个相关对象的家族。</li>
</ul>
<h2 id="6-11-工厂模式和建造者模式有什么区别？它们在解决问题时有何异同？"><a href="#6-11-工厂模式和建造者模式有什么区别？它们在解决问题时有何异同？" class="headerlink" title="6.11 工厂模式和建造者模式有什么区别？它们在解决问题时有何异同？"></a>6.11 <strong>工厂模式和建造者模式有什么区别？它们在解决问题时有何异同？</strong></h2><ul>
<li><strong>区别：</strong><ul>
<li>工厂模式用于创建单个对象，它将对象的创建过程封装在一个工厂类中，客户端只需要关注工厂类即可获取所需的对象实例。</li>
<li>建造者模式用于创建复杂对象，将一个复杂对象的构建过程分解为多个简单的步骤，由具体的建造者类负责实现这些步骤，并通过指挥者来组织这些步骤的执行，最终构建出复杂对象。</li>
</ul>
</li>
<li><strong>异同：</strong><ul>
<li>相同点：都是创建型设计模式，都涉及对象的创建过程，都可以帮助解决对象的创建过程与客户端代码的解耦问题。</li>
<li>不同点：工厂模式关注于创建单个对象，而建造者模式关注于创建复杂对象，涉及对象构建过程的复杂性和组合方式。</li>
</ul>
</li>
</ul>
<h2 id="6-12-工厂模式和单例模式之间有什么关系？它们之间有何联系？"><a href="#6-12-工厂模式和单例模式之间有什么关系？它们之间有何联系？" class="headerlink" title="6.12 工厂模式和单例模式之间有什么关系？它们之间有何联系？"></a>6.12 <strong>工厂模式和单例模式之间有什么关系？它们之间有何联系？</strong></h2><ul>
<li>工厂模式和单例模式是两种不同类型的设计模式，它们解决了不同的问题，没有直接的关系。</li>
<li>工厂模式是用于创建对象的一种模式，它可以帮助将对象的创建过程与客户端代码解耦。</li>
<li>单例模式是一种创建型设计模式，用于确保一个类只有一个实例，并提供一个全局访问点来访问该实例。</li>
</ul>
<h2 id="6-13-在你之前的项目中是否使用过工厂模式？能否分享一些具体的应用经验？"><a href="#6-13-在你之前的项目中是否使用过工厂模式？能否分享一些具体的应用经验？" class="headerlink" title="6.13 在你之前的项目中是否使用过工厂模式？能否分享一些具体的应用经验？"></a>6.13 <strong>在你之前的项目中是否使用过工厂模式？能否分享一些具体的应用经验？</strong></h2><ul>
<li>是的，我在之前的项目中使用过工厂模式。一个具体的应用场景是在一个电商平台项目中，我们使用工厂模式来创建不同类型的支付方式对象。根据用户选择的支付方式（例如支付宝、微信、银行卡等），工厂类负责创建相应的支付对象，并将其提供给订单处理模块使用。</li>
</ul>
<h2 id="6-14-能够列举一些知名的框架或库中使用了工厂模式的例子吗？"><a href="#6-14-能够列举一些知名的框架或库中使用了工厂模式的例子吗？" class="headerlink" title="6.14 能够列举一些知名的框架或库中使用了工厂模式的例子吗？"></a>6.14 <strong>能够列举一些知名的框架或库中使用了工厂模式的例子吗？</strong></h2><ul>
<li>一些知名的框架或库中使用了工厂模式，<ul>
<li>例如 Java 中的 JDBC（Java Database Connectivity） API，它使用工厂模式来创建数据库连接对象；</li>
<li>Spring Framework 中的 BeanFactory 和 ApplicationContext 使用工厂模式来创建和管理对象实例；</li>
<li>Android 中的 LayoutInflater 使用工厂模式来创建 View 对象等。</li>
</ul>
</li>
</ul>
<h2 id="6-15-工厂模式是如何符合设计原则的？它与哪些设计原则相关？"><a href="#6-15-工厂模式是如何符合设计原则的？它与哪些设计原则相关？" class="headerlink" title="6.15 工厂模式是如何符合设计原则的？它与哪些设计原则相关？"></a>6.15 <strong>工厂模式是如何符合设计原则的？它与哪些设计原则相关？</strong></h2><ul>
<li>工厂模式符合开闭原则（Open Closed Principle）和单一职责原则（Single Responsibility Principle）。<ul>
<li>工厂模式使得系统对扩展开放，对修改关闭，当需要添加新的产品时，只需要添加相应的具体产品类和对应的工厂类，而无需修改客户端代码。</li>
<li>工厂模式将对象的创建过程封装在一个单独的类中，实现了对象的创建和使用的分离，符合单一职责原则。</li>
</ul>
</li>
</ul>
<p>这些问题和答案可以帮助你更好地理解工厂模式，并在面试中给出清晰、准确的回答。</p>
<h1 id="附录-demo"><a href="#附录-demo" class="headerlink" title="附录 demo"></a>附录 demo</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 电脑接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品类：台式电脑</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DesktopComputer</span> <span class="keyword">implements</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This is a desktop computer.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品类：笔记本电脑</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LaptopComputer</span> <span class="keyword">implements</span> <span class="title class_">Computer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This is a laptop computer.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂类：电脑工厂</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ComputerFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Computer <span class="title function_">createComputer</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂类：台式电脑工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DesktopComputerFactory</span> <span class="keyword">extends</span> <span class="title class_">ComputerFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Computer <span class="title function_">createComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DesktopComputer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂类：笔记本电脑工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LaptopComputerFactory</span> <span class="keyword">extends</span> <span class="title class_">ComputerFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Computer <span class="title function_">createComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LaptopComputer</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建台式电脑</span></span><br><span class="line">        <span class="type">ComputerFactory</span> <span class="variable">desktopFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DesktopComputerFactory</span>();</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">desktop</span> <span class="operator">=</span> desktopFactory.createComputer();</span><br><span class="line">        desktop.display();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建笔记本电脑</span></span><br><span class="line">        <span class="type">ComputerFactory</span> <span class="variable">laptopFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LaptopComputerFactory</span>();</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">laptop</span> <span class="operator">=</span> laptopFactory.createComputer();</span><br><span class="line">        laptop.display();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://qingxuan.com/2024/03/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BD%9C%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" data-id="cltzsb87n000pu59k2ivhgykq" data-title="设计模式｜工厂模式" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-消息中间件/Kafka｜处理 Kafka 消息重复的有效措施" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/06/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka%EF%BD%9C%E5%A4%84%E7%90%86%20Kafka%20%E6%B6%88%E6%81%AF%E9%87%8D%E5%A4%8D%E7%9A%84%E6%9C%89%E6%95%88%E6%8E%AA%E6%96%BD/" class="article-date">
  <time class="dt-published" datetime="2024-03-06T14:21:33.462Z" itemprop="datePublished">2024-03-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/06/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka%EF%BD%9C%E5%A4%84%E7%90%86%20Kafka%20%E6%B6%88%E6%81%AF%E9%87%8D%E5%A4%8D%E7%9A%84%E6%9C%89%E6%95%88%E6%8E%AA%E6%96%BD/">Kafka｜处理 Kafka 消息重复的有效措施</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>消息重复是 Kafka 系统中另一个常见的问题，可能发生在生产者、Broker 或消费者三个方面。下面我们来讨论一些可能导致消息重复的场景以及如何处理。</p>
<h2 id="消息重复场景"><a href="#消息重复场景" class="headerlink" title="消息重复场景"></a>消息重复场景</h2><h3 id="生产者端"><a href="#生产者端" class="headerlink" title="生产者端"></a>生产者端</h3><ul>
<li><strong>重试机制导致消息重复</strong>：如果生产者在发送消息时发生错误，并且配置了重试机制，重试成功后可能会导致消息被发送多次，从而导致消息重复。</li>
<li><strong>消息发送成功但响应失败</strong>：在某些情况下，生产者可能会成功将消息发送到 Kafka，但是由于网络问题或其他原因，无法接收到成功响应，这可能会导致生产者误以为消息发送失败而重新发送消息。</li>
</ul>
<h3 id="Kafka-Broker"><a href="#Kafka-Broker" class="headerlink" title="Kafka Broker"></a>Kafka Broker</h3><ul>
<li><strong>消费者组 rebalance</strong>：当消费者组发生 rebalance 时，可能会导致一些消息被多个消费者重复消费。这是因为在 rebalance 过程中，某些分区可能会被重新分配给其他消费者。</li>
<li><strong>偏移量提交失败</strong>：如果消费者在处理完消息后未能正确提交偏移量，那么在下一次重启时，可能会重复消费已经处理过的消息，从而导致消息重复。</li>
</ul>
<h3 id="消费者端"><a href="#消费者端" class="headerlink" title="消费者端"></a>消费者端</h3><ul>
<li><strong>消费者失败并重新加入消费组</strong>：当消费者失败并重新加入消费组时，它可能会从上次提交的偏移量开始消费消息，这可能导致重复消费消息的情况发生。</li>
</ul>
<h2 id="如何防止消息重复"><a href="#如何防止消息重复" class="headerlink" title="如何防止消息重复"></a>如何防止消息重复</h2><p>为了处理消息重复的问题，可以采取以下一些措施：</p>
<ul>
<li><p><strong>幂等性操作</strong>：生产者和消费者应该实现消息处理的幂等性，即使消息重复消费或发送，也不会对系统产生副作用。这可以通过为消息分配唯一的标识符，并在处理消息时检查标识符来实现。</p>
</li>
<li><p><strong>消息去重</strong>：消费者可以在处理消息时维护一个已处理消息的记录，并在接收到新消息时先检查这个记录，确保不会处理重复的消息。</p>
</li>
<li><p><strong>偏移量管理</strong>：消费者应该及时提交偏移量，确保在消费消息时记录消费位置。这可以防止消费者重复消费已经处理过的消息。</p>
</li>
<li><p><strong>使用事务</strong>：在某些情况下，可以使用 Kafka 提供的事务机制来确保消息的一致性和可靠性。事务机制可以在生产者端保证消息的原子性，从而避免重复发送消息。</p>
</li>
</ul>
<p>消息重复可能在生产者、Broker 和消费者的任何环节发生。通过合理配置和实施相应的措施，可以最大程度地减少消息重复的风险。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://qingxuan.com/2024/03/06/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka%EF%BD%9C%E5%A4%84%E7%90%86%20Kafka%20%E6%B6%88%E6%81%AF%E9%87%8D%E5%A4%8D%E7%9A%84%E6%9C%89%E6%95%88%E6%8E%AA%E6%96%BD/" data-id="cltzsb87n000nu59kdxcj1xy5" data-title="Kafka｜处理 Kafka 消息重复的有效措施" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-消息中间件/Kafka｜处理 Kafka 消息丢失的有效措施" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/06/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka%EF%BD%9C%E5%A4%84%E7%90%86%20Kafka%20%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1%E7%9A%84%E6%9C%89%E6%95%88%E6%8E%AA%E6%96%BD/" class="article-date">
  <time class="dt-published" datetime="2024-03-06T14:20:12.990Z" itemprop="datePublished">2024-03-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/06/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka%EF%BD%9C%E5%A4%84%E7%90%86%20Kafka%20%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1%E7%9A%84%E6%9C%89%E6%95%88%E6%8E%AA%E6%96%BD/">Kafka｜处理 Kafka 消息丢失的有效措施</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>消息丢失是 Kafka 系统中一个严重的问题，可能会发生在生产者、Broker 或消费者任何方面。今天我们来讨论一些可能导致消息丢失的场景以及如何解决。</p>
<h2 id="消息丢失场景"><a href="#消息丢失场景" class="headerlink" title="消息丢失场景"></a>消息丢失场景</h2><h3 id="生产者端"><a href="#生产者端" class="headerlink" title="生产者端"></a>生产者端</h3><ul>
<li><strong>异步发送消息</strong>：如果生产者配置为异步发送消息，并且在发送消息后立即关闭或退出，那么可能会导致部分消息尚未完全发送就丢失。</li>
<li><strong>发送失败且不重试</strong>：如果生产者在发送消息时发生错误，并且没有配置重试机制，或者重试次数已经耗尽，那么消息可能会丢失。</li>
<li><strong>未处理异常</strong>：如果生产者在消息发送过程中发生了未捕获的异常，并且没有合适的异常处理机制，可能导致消息丢失。</li>
</ul>
<h3 id="Kafka-Broker"><a href="#Kafka-Broker" class="headerlink" title="Kafka Broker"></a>Kafka Broker</h3><ul>
<li><strong>数据写入失败</strong>：如果 Kafka Broker 在将消息写入到磁盘时发生故障或者存储空间不足，可能会导致消息丢失。</li>
<li><strong>消息丢失</strong>：在某些异常情况下，如硬件故障、网络故障等，可能导致正在传输的消息丢失。</li>
<li><strong>ISR 问题</strong>：如果 ISR 中的所有副本都失败，并且没有足够的副本可用于消息的复制，可能会导致消息丢失。</li>
<li><strong>Leader Broker宕机</strong>：触发选举过程，集群选举了一个落后Leader太多的broker作为Leader，那么落后的那些消息就会丢失了。</li>
<li>Kafka为了提升性能，使用页缓存机制，讲消息写入页缓存而非直接持久化至磁盘，才用了异步批量刷盘机制，也就是说，按照一定的消息量和时间间隔去刷盘，刷盘的动作由操作系统来调度的，如果刷盘之前Broker宕机啦，重启后在页缓存的这部分消息则会丢失。</li>
</ul>
<h3 id="消费者端"><a href="#消费者端" class="headerlink" title="消费者端"></a>消费者端</h3><ul>
<li><strong>消息处理失败</strong>：如果消费者在处理消息时发生错误，并且没有合适的错误处理机制，可能会导致消息丢失。</li>
<li><strong>偏移量提交失败</strong>：如果消费者在处理完消息后未能正确提交偏移量，那么在下一次重启时，可能会重复消费已经处理过的消息，从而导致消息重复或丢失。</li>
<li><strong>消费者组 rebalance</strong>：当消费者组发生 rebalance 时，正在处理的消息可能会丢失，因为 Kafka 会重新分配分区给消费者。</li>
</ul>
<h2 id="如何防止消息丢失"><a href="#如何防止消息丢失" class="headerlink" title="如何防止消息丢失"></a>如何防止消息丢失</h2><p>消息丢失可能发生在生产者、Broker 和消费者的任何环节，通过合理配置和实施相应的措施，可以最大程度地减少消息丢失的风险。</p>
<h3 id="生产者端-1"><a href="#生产者端-1" class="headerlink" title="生产者端"></a>生产者端</h3><ul>
<li><strong>回调机制</strong>：不要使用producer.send(msg)，而要使用producer.send(msg,callback)。</li>
<li><strong>消息确认机制</strong>：生产者可以选择使用消息确认机制来确保消息已经成功发送到 Kafka 集群。这包括三种确认模式：<ul>
<li><strong>acks&#x3D;0</strong>：生产者不会等待任何确认，直接发送下一条消息。</li>
<li><strong>acks&#x3D;1</strong>：生产者会等待 leader 副本确认消息后再发送下一条消息。</li>
<li><strong>acks&#x3D;all</strong>：生产者会等待所有 ISR（In-Sync Replicas，同步副本）确认消息后再发送下一条消息。</li>
</ul>
</li>
<li><strong>重试机制</strong>：生产者可以配置重试机制来应对发送失败的情况。通过配置重试次数和重试间隔，可以确保消息在发生失败时有机会重新发送。 eg：设置retries &#x3D; 3，当出现网络的瞬时抖动时，消息发送可能会失败，此时配置了retries &gt; 0 的 Producer 能够自动重试消息发送，避免消息丢失。</li>
</ul>
<h3 id="Kafka-Broker-端"><a href="#Kafka-Broker-端" class="headerlink" title="Kafka Broker 端"></a>Kafka Broker 端</h3><ul>
<li><strong>副本机制</strong>：Kafka 使用副本机制来确保数据的容错性和可靠性。每个分区的数据会被复制到多个 Broker 上，这些副本中的一个被选为 leader，负责处理读写请求，其他副本则作为 follower。如果 leader 副本失效，Kafka 会从 follower 中选举出新的 leader。</li>
<li><strong>ISR 配置</strong>：Kafka 使用 ISR（In-Sync Replicas）列表来跟踪已经复制到所有副本的消息。只有在 ISR 中的副本确认了消息后，生产者才会认为消息已经成功发送。通过配置 ISR 的大小，可以控制消息的持久性和可靠性。</li>
</ul>
<h3 id="消费者端-1"><a href="#消费者端-1" class="headerlink" title="消费者端"></a>消费者端</h3><ul>
<li><strong>自动提交偏移量</strong>：消费者可以选择自动提交偏移量或手动提交偏移量来跟踪已经消费的消息。在自动提交偏移量的情况下，Kafka 会定期自动提交已经处理的偏移量，确保即使消费者发生故障，也不会丢失已经处理的消息。</li>
<li><strong>消息处理保证</strong>：消费者应该实现消息处理的幂等性，即使消息处理失败或发生重试，也不会对系统产生副作用。这可以通过在处理消息时记录处理状态和实现幂等性操作来实现。</li>
</ul>
<p>通过合理地配置生产者、Broker 和消费者，并实现相关的消息确认、重试和偏移量提交机制，可以有效地防止消息在 Kafka 系统中的丢失。此外，定期监控 Kafka 集群的状态和健康情况，及时发现并处理潜在的问题也是保证消息不丢失的重要措施之一。</p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><h3 id="如何实现消费端的重试功能？"><a href="#如何实现消费端的重试功能？" class="headerlink" title="如何实现消费端的重试功能？"></a>如何实现消费端的重试功能？</h3><ol>
<li><strong>使用消费者组（Consumer Group）</strong>：Kafka 的消费者可以组成消费者组，每个消费者组中的消费者可以并行地处理主题中的消息。这意味着如果一个消费者发生故障或者需要重试，其他消费者仍然可以继续处理消息。</li>
<li><strong>设定适当的重试策略</strong>：在消费者端实现重试功能时，需要定义一个合适的重试策略。这包括重试次数、重试间隔、以及可能的最大延迟时间等参数。通常情况下，重试次数应该是有限的，避免无限制地重试造成系统资源的浪费。</li>
<li><strong>记录处理状态</strong>：消费者在处理消息时，应该记录处理状态，以便在需要重试时能够回滚到正确的状态。这可以通过在消费者端记录已处理消息的偏移量（offset）来实现。</li>
<li><strong>使用消息的元数据</strong>：Kafka 提供了消息的元数据，包括消息的偏移量、分区信息等。消费者可以利用这些元数据来确定重试的起始点，确保不会重复处理已经成功处理过的消息。</li>
<li><strong>实现幂等性操作</strong>：在处理消息时，尽量使操作具有幂等性，即使消息重试多次，也不会导致状态发生变化或者副作用产生。这可以降低重试时的副作用，避免产生意外结果。</li>
<li><strong>监控和报警机制</strong>：实现一个监控和报警机制，用于监视消费者的重试行为和重试次数。及时发现并处理消费者的重试问题，可以提高系统的稳定性和可靠性。</li>
</ol>
<p>实现消费端重试功能需要考虑诸多因素，包括重试策略、消息处理状态、幂等性操作等。通过合理地设计和实现，可以提高消费者对消息处理的可靠性和稳定性。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://qingxuan.com/2024/03/06/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka%EF%BD%9C%E5%A4%84%E7%90%86%20Kafka%20%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1%E7%9A%84%E6%9C%89%E6%95%88%E6%8E%AA%E6%96%BD/" data-id="cltzsb87n000mu59k5r9a9qhm" data-title="Kafka｜处理 Kafka 消息丢失的有效措施" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-消息中间件/消息中间件｜初识消息队列" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/03/04/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BD%9C%E5%88%9D%E8%AF%86%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" class="article-date">
  <time class="dt-published" datetime="2024-03-04T14:17:58.804Z" itemprop="datePublished">2024-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/03/04/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BD%9C%E5%88%9D%E8%AF%86%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息中间件｜初识消息队列</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="消息队列是什么？"><a href="#消息队列是什么？" class="headerlink" title="消息队列是什么？"></a>消息队列是什么？</h1><ul>
<li>消息队列（Message Queue）是一种用于在软件系统之间传递消息的通信机制。其本质是一个保存数据的队列，它通常被用于解耦不同组件或模块之间的通信，以实现异步通信、提高系统的可伸缩性和可靠性。</li>
<li>消息中间件是利用高效可靠的消息传递机制进行与平台无关的数据交流，并基于数据通信来进行分布式系统的构建。</li>
<li>消息中间件是分布式系统中重要的组件，主要解决应用解耦、异步消息、流量削峰等问题，实现高性能、高可用、可伸缩和最终一致性的系统架构。目前常见的消息队列系统包括<code>Apache Kafka</code>、<code>RabbitMQ</code>、<code>RocketMQ</code>、<code>ActiveMQ</code>等。</li>
</ul>
<h1 id="消息队列关键概念"><a href="#消息队列关键概念" class="headerlink" title="消息队列关键概念"></a>消息队列关键概念</h1><ul>
<li><strong>消息生产者（Producer）</strong>：负责产生消息并将其发送到消息队列中。</li>
<li><strong>消息队列（Message Queue）</strong>：用于存储消息的缓冲区或中介。消息队列可以是内存中的数据结构，也可以是持久化的存储系统。</li>
<li><strong>消息消费者（Consumer）</strong>：从消息队列中获取消息，并进行相应的处理。消费者负责处理消息的逻辑，通常是异步地从队列中拉取消息。</li>
<li><strong>消息</strong>：要在系统中传递的数据单元。消息可以是任何形式的数据，如文本、<code>JSON</code>、<code>XML</code> 等。</li>
</ul>
<h1 id="消息队列优点"><a href="#消息队列优点" class="headerlink" title="消息队列优点"></a>消息队列优点</h1><ul>
<li><strong>解耦性</strong>：生产者和消费者之间通过消息队列进行通信，彼此不需要直接连接，降低了耦合度。</li>
<li><strong>异步通信</strong>：生产者和消费者可以独立运行，不需要等待对方的响应。</li>
<li><strong>增强系统可靠性</strong>：即使一个组件或模块不可用，消息仍然可以被存储在队列中，待组件恢复后继续处理。</li>
<li><strong>缓冲能力</strong>：消息队列可以作为缓冲，处理高峰时段的突发流量，以及平滑系统的负载。</li>
</ul>
<h1 id="消息队列的应用场景"><a href="#消息队列的应用场景" class="headerlink" title="消息队列的应用场景"></a>消息队列的应用场景</h1><h2 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h2><p>将一些非核心的业务流程以异步并行的方式执行，从而减少请求响应时间，提高系统吞吐量。</p>
<h2 id="应用解耦"><a href="#应用解耦" class="headerlink" title="应用解耦"></a>应用解耦</h2><p>就是接触应用系统之间的耦合依赖，通过消息队列，使每个应用系统不必受其他系统影响，可以更独立自主。</p>
<h2 id="流量削峰"><a href="#流量削峰" class="headerlink" title="流量削峰"></a>流量削峰</h2><p>流量削峰一般在秒杀和团抢活动中使用广泛，在应用前端加入消息队列，秒杀业务处理系统根据消息队列中的请求信息，再做后续处理。</p>
<h2 id="消息通讯"><a href="#消息通讯" class="headerlink" title="消息通讯"></a>消息通讯</h2><p>消息通讯是指应用间的数据通信。消息队列一般都内置了高效的通信机制，因此可以用在纯的消息通讯。比如实现点对点消息队列，或者聊天室等对点通讯。</p>
<h1 id="常用消息队列中间件的对比"><a href="#常用消息队列中间件的对比" class="headerlink" title="常用消息队列中间件的对比"></a>常用消息队列中间件的对比</h1><p>目前常见的消息队列系统包括 <code>Apache Kafka</code>、<code>RabbitMQ</code>、<code>RocketMQ</code>、<code>ActiveMQ</code>等，选择合适的消息队列取决于应用的需求、性能要求以及可用的基础设施。</p>
<table>
<thead>
<tr>
<th></th>
<th>kafka</th>
<th>RabbitMQ</th>
<th>RocketMQ</th>
<th>ActiveMQ</th>
</tr>
</thead>
<tbody><tr>
<td>资料文档</td>
<td>中等</td>
<td>多</td>
<td>少</td>
<td>多</td>
</tr>
<tr>
<td>开发语言</td>
<td>Scala</td>
<td>Eriang</td>
<td>Java</td>
<td>Java</td>
</tr>
<tr>
<td>支持协议</td>
<td>自定义（基于TCP）</td>
<td>AMQP</td>
<td>自定义</td>
<td>OpenWire、STOMP、RESR、XMPP、AMQP</td>
</tr>
<tr>
<td>消息存储</td>
<td>内存、磁盘、数据库；支持大量堆积</td>
<td>内存、磁盘；支持少量堆积</td>
<td>磁盘；支持大量堆积</td>
<td>内存，磁盘，数据库；支持少量堆积</td>
</tr>
<tr>
<td>消息事务</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>负载均衡</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>可基于zk实现负载均衡</td>
</tr>
<tr>
<td>集群管理</td>
<td>leader-slave</td>
<td>支持简单集群</td>
<td>master-slave</td>
<td>支持简单集群</td>
</tr>
<tr>
<td>管理界面</td>
<td>一般</td>
<td>好</td>
<td>很好</td>
<td>一般</td>
</tr>
<tr>
<td>可用性</td>
<td>非常高</td>
<td>高</td>
<td>非常高</td>
<td>高</td>
</tr>
<tr>
<td>吞吐TPS</td>
<td>极大</td>
<td>比较大</td>
<td>大</td>
<td>比较大</td>
</tr>
<tr>
<td>顺序消息</td>
<td>支持</td>
<td>不支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>消息确认</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
<td>支持</td>
</tr>
<tr>
<td>消息回调</td>
<td>支持指定分区offset位置回调</td>
<td>不支持</td>
<td>支持指定时间点的回调</td>
<td>不支持</td>
</tr>
<tr>
<td>消息重试</td>
<td>不支持</td>
<td>不支持</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>并发度</td>
<td>高</td>
<td>极高</td>
<td>高</td>
<td>高</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://qingxuan.com/2024/03/04/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BD%9C%E5%88%9D%E8%AF%86%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" data-id="cltzsb87n000ou59kchag6n6a" data-title="消息中间件｜初识消息队列" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-设计模式/设计模式｜策略模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/02/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BD%9C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/" class="article-date">
  <time class="dt-published" datetime="2024-02-28T14:09:08.310Z" itemprop="datePublished">2024-02-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/02/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BD%9C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/">设计模式｜策略模式</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>策略模式（Strategy Pattern）是一种行为设计模式，它允许在运行时选择算法的行为。它定义了一系列算法，将每个算法封装起来，并且使它们可以互相替换。策略模式可以使算法独立于使用它的客户端而变化。</p>
<h2 id="策略模式的结构"><a href="#策略模式的结构" class="headerlink" title="策略模式的结构"></a>策略模式的结构</h2><p>策略模式包括以下结构：</p>
<ul>
<li><p><strong>Context（上下文）</strong>：上下文是持有一个策略引用的类。上下文将客户端的请求委派给策略对象，客户端通过上下文来与策略进行交互。</p>
</li>
<li><p><strong>Strategy（策略）</strong>：策略是一个接口或抽象类，定义所有支持的算法的公共接口。它使得算法可以相互替换，而不影响使用算法的客户端。</p>
</li>
<li><p><strong>ConcreteStrategy（具体策略）</strong>：具体策略实现了策略接口，提供了算法的具体实现。</p>
</li>
</ul>
<h2 id="策略模式的使用场景"><a href="#策略模式的使用场景" class="headerlink" title="策略模式的使用场景"></a>策略模式的使用场景</h2><p>策略模式在以下情况下可以被考虑使用：</p>
<ul>
<li><p><strong>算法需要灵活变化</strong>：当系统中某个算法的实现经常变化，并且希望在运行时能够灵活选择不同算法时，策略模式就能够胜任这个任务。</p>
</li>
<li><p><strong>避免使用条件语句</strong>：当一个类有多个行为，而这些行为在代码中通过条件语句进行切换时，策略模式可以避免使用大量的条件语句，提高代码的可读性和可维护性。</p>
</li>
<li><p><strong>相同行为的多种实现</strong>：当一个类的某个行为有多种不同的实现方式，可以使用策略模式来封装这些实现，使得可以在运行时动态切换。</p>
</li>
<li><p><strong>算法独立于客户端</strong>：当算法涉及的数据不应该被客户端暴露，或者算法的实现对客户端无关紧要时，使用策略模式可以保持算法的封装性。</p>
</li>
<li><p><strong>系统有许多类，而它们之间只有一些区别</strong>：当一系列类仅仅是行为有所不同，可以使用策略模式来避免大量的相似类的产生。</p>
</li>
<li><p><strong>支持开放&#x2F;封闭原则</strong>：策略模式支持对算法的独立扩展，使得新增的算法不需要修改现有的代码，符合开放&#x2F;封闭原则。</p>
</li>
<li><p><strong>需要在运行时动态选择算法</strong>：当需要在运行时动态地选择算法时，策略模式是一个很好的选择，因为它允许客户端在不修改代码的情况下切换算法。</p>
</li>
</ul>
<p>总的来说，策略模式适用于<strong>需要在运行时选择算法</strong>的场景，以及<strong>希望将算法的实现与调用方解耦</strong>的情况。</p>
<h2 id="策略模式的优缺点"><a href="#策略模式的优缺点" class="headerlink" title="策略模式的优缺点"></a>策略模式的优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li><p><strong>算法的独立性</strong>：通过将算法封装在独立的策略类中，可以使得它们易于切换、理解和扩展，而不会影响到上下文。</p>
</li>
<li><p><strong>避免条件语句</strong>：策略模式可以避免大量的条件语句，使代码更加清晰、易于维护。</p>
</li>
<li><p><strong>增强了对象的封装性</strong>：每个具体策略都是一个独立的类，策略模式有助于避免使用复杂的条件逻辑，并且使得每个策略的实现可以更加独立。</p>
</li>
</ul>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li><p><strong>增加类的数量</strong>：引入策略模式会增加系统中类的数量，每个具体策略都需要一个单独的类，这可能会导致类的数量增多，增加了系统的复杂度和理解难度。</p>
</li>
<li><p><strong>客户端必须了解所有的策略</strong>：在使用策略模式时，客户端必须了解所有可用的策略，并且决定使用哪一个策略。这可能会增加客户端的复杂性。</p>
</li>
<li><p><strong>增加对象之间的通信开销</strong>：在策略模式中，上下文对象和具体策略对象之间需要进行通信，这可能会增加对象之间的通信开销，特别是在需要频繁切换策略的情况下。</p>
</li>
<li><p><strong>选择正确的策略</strong>：选择正确的策略可能会带来一定的复杂性。如果策略选择不当，可能会导致性能下降或者产生错误的结果。</p>
</li>
<li><p><strong>可能导致类爆炸</strong>：如果系统中有大量的策略，可能会导致类的爆炸，增加维护和理解的复杂度。</p>
</li>
</ul>
<p>尽管策略模式存在一些缺点，但在很多情况下，这些缺点都可以通过合理的设计和权衡来解决。在需要根据不同的情况选择不同的算法时，策略模式仍然是一个非常有用的设计模式。</p>
<h2 id="策略模式的示例"><a href="#策略模式的示例" class="headerlink" title="策略模式的示例"></a>策略模式的示例</h2><p>假设有一个电商平台，根据不同的支付方式（策略），计算订单的最终价格。我们可以通过策略模式来实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义策略接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">calculate</span><span class="params">(<span class="type">double</span> amount)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CardPaymentStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculate</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> amount * <span class="number">0.98</span>; <span class="comment">// 2% discount for card payment</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PayPalPaymentStrategy</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculate</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> amount * <span class="number">0.95</span>; <span class="comment">// 5% discount for PayPal payment</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShoppingCart</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentStrategy paymentStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPaymentStrategy</span><span class="params">(PaymentStrategy paymentStrategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentStrategy = paymentStrategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">checkout</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">// 计算最终价格</span></span><br><span class="line">        <span class="keyword">return</span> paymentStrategy.calculate(amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">        cart.setPaymentStrategy(<span class="keyword">new</span> <span class="title class_">PayPalPaymentStrategy</span>()); <span class="comment">// 选择 PayPal 支付方式</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">amount</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="type">double</span> <span class="variable">finalAmount</span> <span class="operator">=</span> cart.checkout(amount);</span><br><span class="line">        System.out.println(<span class="string">&quot;Final amount after payment: &quot;</span> + finalAmount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个示例中，通过将不同的支付方式封装在不同的策略类中，客户端（即购物车）可以根据需要选择不同的支付方式，而不需要修改购物车的代码。这样使得系统更加灵活和可扩展。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://qingxuan.com/2024/02/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BD%9C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/" data-id="cltzsb87o000qu59kfdlp84uw" data-title="设计模式｜策略模式" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-MySQL｜删除mysql数据表内的重复数据记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/02/26/MySQL%EF%BD%9C%E5%88%A0%E9%99%A4mysql%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%86%85%E7%9A%84%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95/" class="article-date">
  <time class="dt-published" datetime="2024-02-26T15:44:16.581Z" itemprop="datePublished">2024-02-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/02/26/MySQL%EF%BD%9C%E5%88%A0%E9%99%A4mysql%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%86%85%E7%9A%84%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95/">MySQL｜删除mysql数据表内的重复数据记录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>删除数据表内重复数据的常规顺序是：创建备份、确定重复记录、编写删除语句</p>
<h1 id="方法一-借助-inner-join"><a href="#方法一-借助-inner-join" class="headerlink" title="方法一: 借助 inner join"></a>方法一: 借助 inner join</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> t1 <span class="keyword">FROM</span> <span class="keyword">table</span> t1</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="keyword">table</span> t2 </span><br><span class="line"><span class="keyword">WHERE</span> t1.id <span class="operator">&lt;</span> t2.id <span class="keyword">AND</span> t1.column1 <span class="operator">=</span> t2.column1;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>table</code>是表名，<code>id</code>是表的唯一标识符，<code>column1</code>是想要根据其删除重复记录的列。这条SQL语句会删除<code>column1</code>列中具有相同值的所有记录，除了<code>id</code>最大的那一条记录。</li>
<li>工作方式是，它会为表中的每个重复的<code>column1</code>值找到<code>id</code>值最小的记录，并将其删除。这样，只有<code>id</code>值最大的记录会被保留下来。</li>
</ul>
<p><strong>注：在执行操作之前，务必备份数据，以防万一。</strong></p>
<h1 id="方法二-借助-group-by"><a href="#方法二-借助-group-by" class="headerlink" title="方法二: 借助 group by"></a>方法二: 借助 group by</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> your_table</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">MAX</span>(id)</span><br><span class="line">    <span class="keyword">FROM</span> your_table</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> column1, column2, ... <span class="comment">/* 列出用于判断重复的列 */</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>这条语句会保留每组重复记录中的最大的 <code>id</code>，并删除其他重复记录。<code>column1</code>, <code>column2</code> 为用来判断重复的列名。</li>
</ul>
<p><strong>注：在执行操作之前，务必备份数据，以防万一。</strong></p>
<h1 id="方法三：借助-临时表"><a href="#方法三：借助-临时表" class="headerlink" title="方法三：借助 临时表"></a>方法三：借助 临时表</h1><p>如果数据量很大，删除重复数据可以采用创建临时表的方式，效率更高。<br>步骤：</p>
<ol>
<li><p>创建一个新的临时表，并将去重后的数据插入到新表中。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> new_table <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> old_table</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> column_to_be_deduplicated;</span><br></pre></td></tr></table></figure>
<p>在这里，<code>new_table</code> 是新创建的临时表的名字，<code>old_table</code> 是原来的表名，<code>column_to_be_deduplicated</code> 是需要去重的列名。</p>
</li>
<li><p>删除原来的表&#x2F;修改原来的表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> old_table;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME <span class="keyword">TABLE</span> old_table <span class="keyword">TO</span> old_table_bak;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将新的临时表重命名为原来的表名。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME <span class="keyword">TABLE</span> new_table <span class="keyword">TO</span> old_table;</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>这种方式是先将去重后的数据插入到一个新的临时表，然后删除旧的表&#x2F;修改旧表的名字，最后将临时表重命名为旧表的名字，好处是在处理大量数据时，效率会更高。</li>
<li>在第二步的时候不建议采用直接删除旧表的方式，凡是涉及到数据变动的，均需万分谨慎。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://qingxuan.com/2024/02/26/MySQL%EF%BD%9C%E5%88%A0%E9%99%A4mysql%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%86%85%E7%9A%84%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E8%AE%B0%E5%BD%95/" data-id="cltzsb87l000eu59kc1mc0bvb" data-title="MySQL｜删除mysql数据表内的重复数据记录" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-幂等及幂等实现方案" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/02/26/%E5%B9%82%E7%AD%89%E5%8F%8A%E5%B9%82%E7%AD%89%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/" class="article-date">
  <time class="dt-published" datetime="2024-02-26T15:41:56.236Z" itemprop="datePublished">2024-02-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/02/26/%E5%B9%82%E7%AD%89%E5%8F%8A%E5%B9%82%E7%AD%89%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/">幂等及幂等实现方案</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="什么是幂等"><a href="#什么是幂等" class="headerlink" title="什么是幂等"></a>什么是幂等</h1><ul>
<li>多次执行所产生的影响与一次执行的影响相同；</li>
<li>幂等性：多次调用方法或者接口不会改变业务状态，可以保证重复调用的结果和单次调用的结果一致</li>
</ul>
<h1 id="使用幂等的场景"><a href="#使用幂等的场景" class="headerlink" title="使用幂等的场景"></a>使用幂等的场景</h1><ul>
<li>前端重复提交</li>
<li>接口超时重试</li>
<li>消息重复消费：在使用消息中间件来处理消息队列，且手动 ack 确认消息被正常消费时。如果消费者突然断开连接，那么已经执行了一半的消息会重新放回队列。当消息被其他消费者重新消费时，如果没有幂等性，就会导致消息重复消费时结果异常，如数据库重复数据，数据库数据冲突，资源重复等</li>
</ul>
<h1 id="幂等实现方案"><a href="#幂等实现方案" class="headerlink" title="幂等实现方案"></a>幂等实现方案</h1><h2 id="token机制实现"><a href="#token机制实现" class="headerlink" title="token机制实现"></a>token机制实现</h2><p><strong>具体流程步骤</strong>：</p>
<ol>
<li>客户端会先发送一个请求去获取 token，服务端会生成一个全局唯一的 ID 作为 token 保存在 redis 中，同时把这个 ID 返回给客户端</li>
<li>客户端第二次调用业务请求的时候必须携带这个 token</li>
<li>服务端会校验这个 token，如果校验成功，则执行业务，并删除 redis 中的 token</li>
<li>如果校验失败，说明 redis 中已经没有对应的 token，则表示重复操作，直接返回指定的结果给客户端</li>
</ol>
<p><strong>注意事项</strong>：<br>1.	对 redis 中是否存在 token 以及删除的代码逻辑建议用 Lua 脚本实现，保证原子性<br>2.	全局唯一 ID 可以用百度的 uid-generator、美团的 Leaf 去生成</p>
<h2 id="MySQL实现"><a href="#MySQL实现" class="headerlink" title="MySQL实现"></a>MySQL实现</h2><ol>
<li>利用 mysql 唯一索引的特性</li>
<li>建立一张去重表，其中某个字段需要建立唯一索引</li>
<li>客户端去请求服务端，服务端会将这次请求的一些信息插入这张去重表中</li>
<li>因为表中某个字段带有唯一索引，如果插入成功，证明表中没有这次请求的信息，则执行后续的业务逻辑</li>
<li>如果插入失败，则代表已经执行过当前请求，直接返回</li>
</ol>
<h2 id="Redis实现"><a href="#Redis实现" class="headerlink" title="Redis实现"></a>Redis实现</h2><ol>
<li>这种实现方式是基于 SETNX 命令实现的</li>
<li>SETNX key value：将 key 的值设为 value ，当且仅当 key 不存在。若给定的 key 已经存在，则 SETNX 不做任何动作。</li>
<li>该命令在设置成功时返回 1，设置失败时返回 0。</li>
<li>具体流程步骤：<br>a. 客户端先请求服务端，会拿到一个能代表这次请求业务的唯一字段<br>b. 将该字段以 SETNX 的方式存入 redis 中，并根据业务设置相应的超时时间<br>c. 如果设置成功，证明这是第一次请求，则执行后续的业务逻辑<br>d. 如果设置失败，则代表已经执行过当前请求，直接返回</li>
</ol>
<h2 id="实现总结"><a href="#实现总结" class="headerlink" title="实现总结"></a>实现总结</h2><p>这几种实现幂等的方式其实都是大同小异的，类似的还有使用状态机、悲观锁、乐观锁的方式来实现，都是比较简单的。<br>总之，当设计一个接口的时候，幂等都是首要考虑的问题，特别是当负责设计转账、支付这种涉及到 money 的接口，要格外注意!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://qingxuan.com/2024/02/26/%E5%B9%82%E7%AD%89%E5%8F%8A%E5%B9%82%E7%AD%89%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/" data-id="cltzsb87m000fu59kbc946aj2" data-title="幂等及幂等实现方案" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-MySQL语句 ｜ 删除指令deleted和truncate在使用中的异同" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/02/05/MySQL%E8%AF%AD%E5%8F%A5%20%EF%BD%9C%20%E5%88%A0%E9%99%A4%E6%8C%87%E4%BB%A4deleted%E5%92%8Ctruncate%E5%9C%A8%E4%BD%BF%E7%94%A8%E4%B8%AD%E7%9A%84%E5%BC%82%E5%90%8C/" class="article-date">
  <time class="dt-published" datetime="2024-02-05T14:36:33.575Z" itemprop="datePublished">2024-02-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/02/05/MySQL%E8%AF%AD%E5%8F%A5%20%EF%BD%9C%20%E5%88%A0%E9%99%A4%E6%8C%87%E4%BB%A4deleted%E5%92%8Ctruncate%E5%9C%A8%E4%BD%BF%E7%94%A8%E4%B8%AD%E7%9A%84%E5%BC%82%E5%90%8C/">MySQL语句 ｜ 删除指令deleted和truncate在使用中的异同</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在MySQL中，<code>DELETE</code> 和 <code>TRUNCATE</code> 是两种不同的数据操作命令，虽然都能起到删除数据的作用，但是功能和影响均有所不同。</p>
<h1 id="理论"><a href="#理论" class="headerlink" title="理论"></a>理论</h1><ol>
<li><strong>功能</strong>：</li>
</ol>
<ul>
<li><code>DELETE</code> 用于从表中删除特定的行，通常基于特定的条件。</li>
<li><code>TRUNCATE</code> 用于删除表中的所有数据，但保留表的结构。</li>
</ul>
<ol start="2">
<li><strong>事务性</strong>：</li>
</ol>
<ul>
<li><code>DELETE</code> 是DML（数据操纵语言）命令，因此可以在事务中使用，并且可以通过 <code>ROLLBACK</code> 撤消删除操作。</li>
<li><code>TRUNCATE</code> 是DDL（数据定义语言）命令，不能在事务中使用，也无法通过 <code>ROLLBACK</code> 撤消删除操作。</li>
</ul>
<ol start="3">
<li><strong>性能</strong>：</li>
</ol>
<ul>
<li>删除大量数据时可能较慢，特别是如果表有索引，删除过程可能需要更新索引，因此相对较慢。</li>
<li><code>TRUNCATE</code> 的性能通常比 <code>DELETE</code> 更好，特别是在删除大量数据时，因为它不记录删除的每一行，而是直接释放存储空间。</li>
</ul>
<ol start="4">
<li><strong>影响</strong>：</li>
</ol>
<ul>
<li><code>DELETE</code> 仅删除满足条件的行，不影响表的结构。但是，它会记录删除的每一行，因此可能会增加事务日志的大小。</li>
<li><code>TRUNCATE</code> 删除表中的所有行，但是保留表的结构，包括索引、约束等。它将表的自增长计数器重置为初始值。</li>
</ul>
<ol start="5">
<li><strong>总结</strong>：</li>
</ol>
<ul>
<li><code>DELETE</code> 是DML命令，适合用于删除特定行，支持条件删除，并且可以在事务中使用，但是它比较慢且增加了事务日志的大小。</li>
<li><code>TRUNCATE</code> 是DDL命令，用于删除表中的所有数据，性能通常比 <code>DELETE</code> 更好，但是无法撤销操作，且会重置自增长计数器。</li>
</ul>
<h1 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h1><p>假设有一个名为 <code>employees</code> 的表，其中包含员工的信息，包括 <code>id</code>、<code>name</code> 和 <code>salary</code>。现在需要删除这个表内的数据，并比较使用 <code>DELETE</code> 和 <code>TRUNCATE</code> 的效果。</p>
<ol>
<li><strong>使用 DELETE</strong>：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除表中薪资低于 3000 的员工记录</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>
在这种情况下，<code>DELETE</code> 将删除所有薪资低于 3000 的员工记录。如果表中有许多匹配的行，则 <code>DELETE</code> 将逐行删除这些行。这可能需要一些时间，特别是如果表很大。</li>
<li><strong>使用 TRUNCATE</strong>：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 清空整个表</span></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> employees;</span><br></pre></td></tr></table></figure>
<code>TRUNCATE</code> 将清空整个表，即删除表中的所有行，但保留表的结构。在执行 <code>TRUNCATE</code> 后，表中的自增长计数器将重置为初始值，而且不会触发触发器。</li>
<li><strong>对比</strong>：</li>
</ol>
<ul>
<li>使用 <code>DELETE</code> 时，我们可以根据条件选择性地删除行，而 <code>TRUNCATE</code> 则是将整个表清空。</li>
<li><code>DELETE</code> 是 DML 操作，可以在事务中使用，可以撤消，但可能比较慢。</li>
<li><code>TRUNCATE</code> 是 DDL 操作，不可回滚，性能通常比 <code>DELETE</code> 更好。</li>
</ul>
<p>因此，如果需要精确控制删除的行或者需要保留表的结构，可以使用 <code>DELETE</code>。如果只是需要快速清空整个表而不关心数据内容，可以考虑使用 <code>TRUNCATE</code>。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://qingxuan.com/2024/02/05/MySQL%E8%AF%AD%E5%8F%A5%20%EF%BD%9C%20%E5%88%A0%E9%99%A4%E6%8C%87%E4%BB%A4deleted%E5%92%8Ctruncate%E5%9C%A8%E4%BD%BF%E7%94%A8%E4%B8%AD%E7%9A%84%E5%BC%82%E5%90%8C/" data-id="cltzsb87k0009u59k9axrd8rw" data-title="MySQL语句 ｜ 删除指令deleted和truncate在使用中的异同" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-MySQL语句｜条件语句 IFNULL 和 COALESCE 的区别" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/02/02/MySQL%E8%AF%AD%E5%8F%A5%EF%BD%9C%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5%20IFNULL%20%E5%92%8C%20COALESCE%20%E7%9A%84%E5%8C%BA%E5%88%AB/" class="article-date">
  <time class="dt-published" datetime="2024-02-02T15:16:15.626Z" itemprop="datePublished">2024-02-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/02/02/MySQL%E8%AF%AD%E5%8F%A5%EF%BD%9C%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5%20IFNULL%20%E5%92%8C%20COALESCE%20%E7%9A%84%E5%8C%BA%E5%88%AB/">MySQL语句｜条件语句 IFNULL 和 COALESCE 的区别</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在MySQL中，<code>IFNULL</code>和<code>COALESCE</code>都是用来处理<code>NULL</code>值的函数，但它们之间存在一些重要的差异。</p>
<h1 id="函数定义"><a href="#函数定义" class="headerlink" title="函数定义"></a>函数定义</h1><ul>
<li><code>IFNULL(expr1, expr2)</code>: 如果<code>expr1</code>为<code>NULL</code>，则返回<code>expr2</code>，否则返回<code>expr1</code>。</li>
<li><code>COALESCE(value1, value2, ..., valueN)</code>: 返回参数列表中的第一个非<code>NULL</code>值。</li>
</ul>
<h1 id="参数数量"><a href="#参数数量" class="headerlink" title="参数数量"></a>参数数量</h1><ul>
<li><code>IFNULL</code>接受两个参数。</li>
<li><code>COALESCE</code>可以接受任意数量的参数。</li>
</ul>
<h1 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h1><ul>
<li>当你知道有两个可能的值时，可以使用<code>IFNULL</code>。</li>
<li>当处理一个值的列表，并希望返回第一个有效的值时，可以使用<code>COALESCE</code>。</li>
</ul>
<h1 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="keyword">NULL</span>, <span class="string">&#x27;backup_value&#x27;</span>) <span class="keyword">AS</span> IFNULL_Result;  <span class="comment">-- 结果: backup_value</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COALESCE</span>(<span class="keyword">NULL</span>, <span class="string">&#x27;backup_value&#x27;</span>) <span class="keyword">AS</span> COALESCE_Result;  <span class="comment">-- 结果: backup_value</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> IFNULL(<span class="string">&#x27;not_null_value&#x27;</span>, <span class="string">&#x27;backup_value&#x27;</span>) <span class="keyword">AS</span> IFNULL_Result;  <span class="comment">-- 结果: not_null_value</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COALESCE</span>(<span class="string">&#x27;not_null_value&#x27;</span>, <span class="string">&#x27;backup_value&#x27;</span>) <span class="keyword">AS</span> COALESCE_Result;  <span class="comment">-- 结果: not_null_value</span></span><br></pre></td></tr></table></figure>
<p>当多个可能值的时候：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COALESCE</span>(<span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;third_value&#x27;</span>, <span class="string">&#x27;fourth_value&#x27;</span>) <span class="keyword">AS</span> COALESCE_Result;  <span class="comment">-- 结果: third_value</span></span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li><code>IFNULL</code>只检查第一个参数是否为<code> NULL</code>，而<code>COALESCE</code>会检查所有参数。</li>
<li>对于只有两个参数的情况，<code>IFNULL(expr1, expr2</code>)和<code>COALESCE(expr1, expr2)</code>有相同的效果。</li>
<li>在某些场景下，可能想使用多个备选值，而不仅仅是两个，这时<code>COALESCE</code>会更有用。<br>简言之，如果只关心第一个参数是否为 <code>NULL</code>，并为其提供一个备选值，那么可以使用<code>IFNULL</code>。而r若想从多个值中选择第一个非 <code>NULL</code> 的值，那么应该使用<code>COALESCE</code>。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://qingxuan.com/2024/02/02/MySQL%E8%AF%AD%E5%8F%A5%EF%BD%9C%E6%9D%A1%E4%BB%B6%E8%AF%AD%E5%8F%A5%20IFNULL%20%E5%92%8C%20COALESCE%20%E7%9A%84%E5%8C%BA%E5%88%AB/" data-id="cltzsb87l000du59k0z5v70s3" data-title="MySQL语句｜条件语句 IFNULL 和 COALESCE 的区别" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-MySQL语句 ｜ 条件函数IF/CASE/COALESCE的使用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/01/31/MySQL%E8%AF%AD%E5%8F%A5%20%EF%BD%9C%20%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0IF/CASE/COALESCE%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2024-01-31T13:15:58.303Z" itemprop="datePublished">2024-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2024/01/31/MySQL%E8%AF%AD%E5%8F%A5%20%EF%BD%9C%20%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0IF/CASE/COALESCE%E7%9A%84%E4%BD%BF%E7%94%A8/">MySQL语句 ｜ 条件函数IF/CASE/COALESCE的使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在MySQL中，条件函数用于在查询中根据特定条件来返回不同的结果。常见的条件函数包括 <code>IF()</code>、<code>CASE</code> 等</p>
<h3 id="1-IF-函数"><a href="#1-IF-函数" class="headerlink" title="1. IF() 函数"></a>1. <code>IF()</code> 函数</h3><p><code>IF()</code> 函数用于在满足某个条件时返回一个值，否则返回另一个值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, IF(score <span class="operator">&gt;</span> <span class="number">50</span>, <span class="string">&#x27;Pass&#x27;</span>, <span class="string">&#x27;Fail&#x27;</span>) <span class="keyword">AS</span> <span class="keyword">result</span></span><br><span class="line"><span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，如果学生的分数大于50，则返回 ‘Pass’，否则返回 ‘Fail’。</p>
<h3 id="2-CASE-表达式"><a href="#2-CASE-表达式" class="headerlink" title="2. CASE 表达式"></a>2. <code>CASE</code> 表达式</h3><p><code>CASE</code> 表达式允许在查询中实现更复杂的条件逻辑。</p>
<h4 id="简单-CASE-表达式"><a href="#简单-CASE-表达式" class="headerlink" title="简单 CASE 表达式"></a>简单 CASE 表达式</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name,</span><br><span class="line">       <span class="keyword">CASE</span> score</span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">100</span> <span class="keyword">THEN</span> <span class="string">&#x27;Perfect&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">90</span> <span class="keyword">THEN</span> <span class="string">&#x27;Excellent&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> <span class="number">80</span> <span class="keyword">THEN</span> <span class="string">&#x27;Very Good&#x27;</span></span><br><span class="line">           <span class="keyword">ELSE</span> <span class="string">&#x27;Pass&#x27;</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> <span class="keyword">result</span></span><br><span class="line"><span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，根据分数返回不同的结果。</p>
<h4 id="搜索-CASE-表达式"><a href="#搜索-CASE-表达式" class="headerlink" title="搜索 CASE 表达式"></a>搜索 CASE 表达式</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name,</span><br><span class="line">       <span class="keyword">CASE</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">90</span> <span class="keyword">THEN</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">80</span> <span class="keyword">THEN</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">70</span> <span class="keyword">THEN</span> <span class="string">&#x27;C&#x27;</span></span><br><span class="line">           <span class="keyword">WHEN</span> score <span class="operator">&gt;=</span> <span class="number">60</span> <span class="keyword">THEN</span> <span class="string">&#x27;D&#x27;</span></span><br><span class="line">           <span class="keyword">ELSE</span> <span class="string">&#x27;F&#x27;</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> grade</span><br><span class="line"><span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，根据分数范围返回等级。</p>
<h3 id="3-COALESCE-函数"><a href="#3-COALESCE-函数" class="headerlink" title="3. COALESCE() 函数"></a>3. <code>COALESCE()</code> 函数</h3><p><code>COALESCE()</code> 函数用于返回参数列表中的第一个非空值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, <span class="built_in">COALESCE</span>(score, <span class="number">0</span>) <span class="keyword">AS</span> score</span><br><span class="line"><span class="keyword">FROM</span> students;</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，如果分数为空，则返回0。</p>
<p>这些是一些常见的条件函数和表达式，在MySQL中可用于根据特定条件返回不同的结果。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://qingxuan.com/2024/01/31/MySQL%E8%AF%AD%E5%8F%A5%20%EF%BD%9C%20%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0IF/CASE/COALESCE%E7%9A%84%E4%BD%BF%E7%94%A8/" data-id="cltzsb87o000ru59k96sy4juy" data-title="MySQL语句 ｜ 条件函数IF/CASE/COALESCE的使用" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">十月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">九月 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/03/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BD%9C%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/">设计模式｜工厂模式</a>
          </li>
        
          <li>
            <a href="/2024/03/06/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka%EF%BD%9C%E5%A4%84%E7%90%86%20Kafka%20%E6%B6%88%E6%81%AF%E9%87%8D%E5%A4%8D%E7%9A%84%E6%9C%89%E6%95%88%E6%8E%AA%E6%96%BD/">Kafka｜处理 Kafka 消息重复的有效措施</a>
          </li>
        
          <li>
            <a href="/2024/03/06/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/Kafka%EF%BD%9C%E5%A4%84%E7%90%86%20Kafka%20%E6%B6%88%E6%81%AF%E4%B8%A2%E5%A4%B1%E7%9A%84%E6%9C%89%E6%95%88%E6%8E%AA%E6%96%BD/">Kafka｜处理 Kafka 消息丢失的有效措施</a>
          </li>
        
          <li>
            <a href="/2024/03/04/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BD%9C%E5%88%9D%E8%AF%86%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息中间件｜初识消息队列</a>
          </li>
        
          <li>
            <a href="/2024/02/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BD%9C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/">设计模式｜策略模式</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>